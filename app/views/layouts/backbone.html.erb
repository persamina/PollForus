<!DOCTYPE html>
<html>
  <head>
    <title>PollForUs</title>
    <%= stylesheet_link_tag    "application", :media => "all" %>
    <%= javascript_include_tag "application" %>
    <script src="https://d3dy5gmtp8yhk7.cloudfront.net/2.1/pusher.min.js" type="text/javascript"></script>
    <script type="text/javascript">
      // Enable pusher logging - don't include this in production
   // Pusher.log = function(message) {
     // if (window.console && window.console.log) {
      //  window.console.log(message);
      //}
    //};

    var pusher = new Pusher('<%= Pusher.key %>');
    var channel = pusher.subscribe('all_poll_answers');
    channel.bind('updated', function(data) {
      var current_answer = PollForUs.allAnswers.get(data.answer_id);
      current_answer.set("user_answers", data.user_answers);
    });
  </script>
<%= csrf_meta_tags %>
</head>
<body>
  <% if current_user %>
    <%= button_to "Sign Out", session_url,  method: :delete %>
  <% else %>
    <%= button_to "Sign In", new_session_url, method: :get %> 
    <%= button_to "Sign Up", new_user_url, method: :get %>
  <% end %>

  <% if flash[:errors] %>
    <% flash[:errors].each do |error| %>
      <div class="error"><%= error %><div>
        <% end %>
      <% end %>

      <% if flash[:notice] %>
        <% flash[:notice].each do |notice| %>
          <div class="notice"><%= notice%><div>
            <% end %>
          <% end %>


          <%= yield %>

        </body>
      </html>
